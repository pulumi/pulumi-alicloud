// *** WARNING: this file was generated by pulumi-language-dotnet. ***
// *** Do not edit by hand unless you're certain you know what you are doing! ***

using System;
using System.Collections.Generic;
using System.Collections.Immutable;
using System.Threading.Tasks;
using Pulumi.Serialization;

namespace Pulumi.AliCloud.CS
{
    /// <summary>
    /// This resource will help you configure auto scaling for the kubernetes cluster, see [What is autoscaling config](https://www.alibabacloud.com/help/en/ack/ack-managed-and-ack-dedicated/developer-reference/api-configure-auto-scaling).
    /// 
    /// &gt; **NOTE:** Available since v1.127.0.
    /// 
    /// &gt; **NOTE:** From version 1.164.0, support for specifying whether to allow the scale-in of nodes by parameter `scale_down_enabled`.
    /// 
    /// &gt; **NOTE:** From version 1.164.0, support for selecting the policy for selecting which node pool to scale by parameter `expander`.
    /// 
    /// &gt; **NOTE:** From version 1.237.0, support for selecting the type of autoscaler by parameter `scaler_type`.
    /// 
    /// &gt; **NOTE:** From version 1.256.0, support for setting the priority of scaling groups by parameter `priorities`.
    /// 
    /// ## Example Usage
    /// 
    /// If you do not have an existing cluster, you need to create an ACK cluster through alicloud.cs.ManagedKubernetes first, and then configure automatic scaling.
    /// 
    /// Basic Usage
    /// 
    /// ```csharp
    /// using System.Collections.Generic;
    /// using System.Linq;
    /// using Pulumi;
    /// using AliCloud = Pulumi.AliCloud;
    /// using Std = Pulumi.Std;
    /// 
    /// return await Deployment.RunAsync(() =&gt; 
    /// {
    ///     var config = new Config();
    ///     var name = config.Get("name") ?? "terraform-example";
    ///     var @default = AliCloud.GetZones.Invoke(new()
    ///     {
    ///         AvailableResourceCreation = "VSwitch",
    ///     });
    /// 
    ///     var defaultGetInstanceTypes = AliCloud.Ecs.GetInstanceTypes.Invoke(new()
    ///     {
    ///         AvailabilityZone = @default.Apply(getZonesResult =&gt; getZonesResult.Zones[0]?.Id),
    ///         CpuCoreCount = 4,
    ///         MemorySize = 8,
    ///         KubernetesNodeRole = "Worker",
    ///         SystemDiskCategory = "cloud_essd",
    ///     });
    /// 
    ///     var defaultNetwork = new AliCloud.Vpc.Network("default", new()
    ///     {
    ///         VpcName = name,
    ///         CidrBlock = "10.4.0.0/16",
    ///     });
    /// 
    ///     var defaultSwitch = new AliCloud.Vpc.Switch("default", new()
    ///     {
    ///         VswitchName = name,
    ///         CidrBlock = "10.4.0.0/24",
    ///         VpcId = defaultNetwork.Id,
    ///         ZoneId = @default.Apply(@default =&gt; @default.Apply(getZonesResult =&gt; getZonesResult.Zones[0]?.Id)),
    ///     });
    /// 
    ///     var defaultManagedKubernetes = new AliCloud.CS.ManagedKubernetes("default", new()
    ///     {
    ///         NamePrefix = name,
    ///         ClusterSpec = "ack.pro.small",
    ///         WorkerVswitchIds = new[]
    ///         {
    ///             defaultSwitch.Id,
    ///         },
    ///         NewNatGateway = true,
    ///         PodCidr = Std.Cidrsubnet.Invoke(new()
    ///         {
    ///             Input = "10.0.0.0/8",
    ///             Newbits = 8,
    ///             Netnum = 36,
    ///         }).Apply(invoke =&gt; invoke.Result),
    ///         ServiceCidr = Std.Cidrsubnet.Invoke(new()
    ///         {
    ///             Input = "172.16.0.0/16",
    ///             Newbits = 4,
    ///             Netnum = 7,
    ///         }).Apply(invoke =&gt; invoke.Result),
    ///         SlbInternetEnabled = true,
    ///     });
    /// 
    ///     var defaultNodePool = new List&lt;AliCloud.CS.NodePool&gt;();
    ///     for (var rangeIndex = 0; rangeIndex &lt; 3; rangeIndex++)
    ///     {
    ///         var range = new { Value = rangeIndex };
    ///         defaultNodePool.Add(new AliCloud.CS.NodePool($"default-{range.Value}", new()
    ///         {
    ///             NodePoolName = Std.Format.Invoke(new()
    ///             {
    ///                 Input = "%s-%d",
    ///                 Args = new[]
    ///                 {
    ///                     name,
    ///                     range.Value,
    ///                 },
    ///             }).Apply(invoke =&gt; invoke.Result),
    ///             ClusterId = defaultManagedKubernetes.Id,
    ///             VswitchIds = new[]
    ///             {
    ///                 defaultSwitch.Id,
    ///             },
    ///             InstanceTypes = new[]
    ///             {
    ///                 defaultGetInstanceTypes.Apply(getInstanceTypesResult =&gt; getInstanceTypesResult.InstanceTypes[0]?.Id),
    ///             },
    ///             SystemDiskCategory = "cloud_essd",
    ///             SystemDiskSize = 40,
    ///             ImageType = "AliyunLinux3",
    ///             ScalingConfig = new AliCloud.CS.Inputs.NodePoolScalingConfigArgs
    ///             {
    ///                 Enable = true,
    ///                 MinSize = 0,
    ///                 MaxSize = 10,
    ///             },
    ///         }));
    ///     }
    ///     var defaultAutoscalingConfig = new AliCloud.CS.AutoscalingConfig("default", new()
    ///     {
    ///         ClusterId = defaultManagedKubernetes.Id,
    ///         CoolDownDuration = "10m",
    ///         UnneededDuration = "10m",
    ///         UtilizationThreshold = "0.5",
    ///         GpuUtilizationThreshold = "0.5",
    ///         ScanInterval = "30s",
    ///         ScaleDownEnabled = true,
    ///         Expander = "priority",
    ///         SkipNodesWithSystemPods = true,
    ///         SkipNodesWithLocalStorage = false,
    ///         DaemonsetEvictionForNodes = false,
    ///         MaxGracefulTerminationSec = 14400,
    ///         MinReplicaCount = 0,
    ///         RecycleNodeDeletionEnabled = false,
    ///         ScaleUpFromZero = true,
    ///         ScalerType = "cluster-autoscaler",
    ///         Priorities = 
    ///         {
    ///             { "10", Std.Join.Invoke(new()
    ///             {
    ///                 Separator = ",",
    ///                 Input = new[]
    ///                 {
    ///                     defaultNodePool[0].ScalingGroupId,
    ///                     defaultNodePool[1].ScalingGroupId,
    ///                 },
    ///             }).Apply(invoke =&gt; invoke.Result) },
    ///             { "20", defaultNodePool[2].ScalingGroupId },
    ///         },
    ///     });
    /// 
    /// });
    /// ```
    /// </summary>
    [AliCloudResourceType("alicloud:cs/autoscalingConfig:AutoscalingConfig")]
    public partial class AutoscalingConfig : global::Pulumi.CustomResource
    {
        /// <summary>
        /// The id of kubernetes cluster.
        /// </summary>
        [Output("clusterId")]
        public Output<string?> ClusterId { get; private set; } = null!;

        /// <summary>
        /// Specify the time interval between detecting a scale-in requirement (when the threshold is reached) and actually executing the scale-in operation (reducing the number of Pods). Default is `10m`. If the delay (cooldown) value is set too long, there could be complaints that the Horizontal Pod Autoscaler is not responsive to workload changes. However, if the delay value is set too short, the scale of the replicas set may keep thrashing as usual.
        /// </summary>
        [Output("coolDownDuration")]
        public Output<string?> CoolDownDuration { get; private set; } = null!;

        /// <summary>
        /// If true DaemonSet pods will be  terminated from nodes. Default is `false`.
        /// </summary>
        [Output("daemonsetEvictionForNodes")]
        public Output<bool?> DaemonsetEvictionForNodes { get; private set; } = null!;

        /// <summary>
        /// The policy for selecting which node pool to scale. Valid values: `least-waste`, `random`, `priority`. For scaler type `goatscaler`, only the `least-waste` expander is currently supported. For more information on these policies, see [Configure auto scaling](https://www.alibabacloud.com/help/en/container-service-for-kubernetes/latest/auto-scaling-of-nodes#section-3bg-2ko-inl)
        /// </summary>
        [Output("expander")]
        public Output<string?> Expander { get; private set; } = null!;

        /// <summary>
        /// The scale-in threshold for GPU instance. Default is `0.5`.
        /// </summary>
        [Output("gpuUtilizationThreshold")]
        public Output<string?> GpuUtilizationThreshold { get; private set; } = null!;

        /// <summary>
        /// Maximum number of seconds CA waits for pod termination when trying to scale down a node. Default is `14400`.
        /// </summary>
        [Output("maxGracefulTerminationSec")]
        public Output<int?> MaxGracefulTerminationSec { get; private set; } = null!;

        /// <summary>
        /// Minimum number of replicas that a replica set or replication controller should have to allow their pods deletion in scale down. Default is `0`.
        /// </summary>
        [Output("minReplicaCount")]
        public Output<int?> MinReplicaCount { get; private set; } = null!;

        /// <summary>
        /// Priority settings for autoscaling node pool scaling groups. This parameter only takes effect when `expander` is set to `priority`. Only supports scaler type `cluster-autoscaler`. Uses key-value pairs where the key is the priority value, and the value is a comma-separated list of scaling group IDs. High numerical values indicate higher priority.
        /// </summary>
        [Output("priorities")]
        public Output<ImmutableDictionary<string, string>?> Priorities { get; private set; } = null!;

        /// <summary>
        /// Should CA delete the K8s node object when recycle node has scaled down successfully. Default is `false`.
        /// </summary>
        [Output("recycleNodeDeletionEnabled")]
        public Output<bool?> RecycleNodeDeletionEnabled { get; private set; } = null!;

        /// <summary>
        /// Specify whether to allow the scale-in of nodes. Default is `true`.
        /// </summary>
        [Output("scaleDownEnabled")]
        public Output<bool?> ScaleDownEnabled { get; private set; } = null!;

        /// <summary>
        /// Should CA scale up when there 0 ready nodes. Default is `true`.
        /// </summary>
        [Output("scaleUpFromZero")]
        public Output<bool?> ScaleUpFromZero { get; private set; } = null!;

        /// <summary>
        /// The type of autoscaler. Valid values: `cluster-autoscaler`, `goatscaler`. For cluster version 1.22 and below, we only support `cluster-autoscaler`. When switching from `cluster-autoscaler` to `goatscaler`, all configuration parameters will be automatically migrated.
        /// </summary>
        [Output("scalerType")]
        public Output<string?> ScalerType { get; private set; } = null!;

        /// <summary>
        /// The interval at which the cluster is reevaluated for scaling. Default is `30s`.
        /// </summary>
        [Output("scanInterval")]
        public Output<string?> ScanInterval { get; private set; } = null!;

        /// <summary>
        /// If true cluster autoscaler will never delete nodes with pods with local storage, e.g. EmptyDir or HostPath. Default is `false`.
        /// </summary>
        [Output("skipNodesWithLocalStorage")]
        public Output<bool?> SkipNodesWithLocalStorage { get; private set; } = null!;

        /// <summary>
        /// If true cluster autoscaler will never delete nodes with pods from kube-system (except for DaemonSet or mirror pods). Default is `true`.
        /// </summary>
        [Output("skipNodesWithSystemPods")]
        public Output<bool?> SkipNodesWithSystemPods { get; private set; } = null!;

        /// <summary>
        /// Specify the time interval during which autoscaler does not perform scale-in operations after the most recent scale-out completion. Nodes added through scale-out can only be considered for scale-in after the period has elapsed. Default is `10m`.
        /// </summary>
        [Output("unneededDuration")]
        public Output<string?> UnneededDuration { get; private set; } = null!;

        /// <summary>
        /// The scale-in a threshold. Default is `0.5`.
        /// </summary>
        [Output("utilizationThreshold")]
        public Output<string?> UtilizationThreshold { get; private set; } = null!;


        /// <summary>
        /// Create a AutoscalingConfig resource with the given unique name, arguments, and options.
        /// </summary>
        ///
        /// <param name="name">The unique name of the resource</param>
        /// <param name="args">The arguments used to populate this resource's properties</param>
        /// <param name="options">A bag of options that control this resource's behavior</param>
        public AutoscalingConfig(string name, AutoscalingConfigArgs? args = null, CustomResourceOptions? options = null)
            : base("alicloud:cs/autoscalingConfig:AutoscalingConfig", name, args ?? new AutoscalingConfigArgs(), MakeResourceOptions(options, ""))
        {
        }

        private AutoscalingConfig(string name, Input<string> id, AutoscalingConfigState? state = null, CustomResourceOptions? options = null)
            : base("alicloud:cs/autoscalingConfig:AutoscalingConfig", name, state, MakeResourceOptions(options, id))
        {
        }

        private static CustomResourceOptions MakeResourceOptions(CustomResourceOptions? options, Input<string>? id)
        {
            var defaultOptions = new CustomResourceOptions
            {
                Version = Utilities.Version,
            };
            var merged = CustomResourceOptions.Merge(defaultOptions, options);
            // Override the ID if one was specified for consistency with other language SDKs.
            merged.Id = id ?? merged.Id;
            return merged;
        }
        /// <summary>
        /// Get an existing AutoscalingConfig resource's state with the given name, ID, and optional extra
        /// properties used to qualify the lookup.
        /// </summary>
        ///
        /// <param name="name">The unique name of the resulting resource.</param>
        /// <param name="id">The unique provider ID of the resource to lookup.</param>
        /// <param name="state">Any extra arguments used during the lookup.</param>
        /// <param name="options">A bag of options that control this resource's behavior</param>
        public static AutoscalingConfig Get(string name, Input<string> id, AutoscalingConfigState? state = null, CustomResourceOptions? options = null)
        {
            return new AutoscalingConfig(name, id, state, options);
        }
    }

    public sealed class AutoscalingConfigArgs : global::Pulumi.ResourceArgs
    {
        /// <summary>
        /// The id of kubernetes cluster.
        /// </summary>
        [Input("clusterId")]
        public Input<string>? ClusterId { get; set; }

        /// <summary>
        /// Specify the time interval between detecting a scale-in requirement (when the threshold is reached) and actually executing the scale-in operation (reducing the number of Pods). Default is `10m`. If the delay (cooldown) value is set too long, there could be complaints that the Horizontal Pod Autoscaler is not responsive to workload changes. However, if the delay value is set too short, the scale of the replicas set may keep thrashing as usual.
        /// </summary>
        [Input("coolDownDuration")]
        public Input<string>? CoolDownDuration { get; set; }

        /// <summary>
        /// If true DaemonSet pods will be  terminated from nodes. Default is `false`.
        /// </summary>
        [Input("daemonsetEvictionForNodes")]
        public Input<bool>? DaemonsetEvictionForNodes { get; set; }

        /// <summary>
        /// The policy for selecting which node pool to scale. Valid values: `least-waste`, `random`, `priority`. For scaler type `goatscaler`, only the `least-waste` expander is currently supported. For more information on these policies, see [Configure auto scaling](https://www.alibabacloud.com/help/en/container-service-for-kubernetes/latest/auto-scaling-of-nodes#section-3bg-2ko-inl)
        /// </summary>
        [Input("expander")]
        public Input<string>? Expander { get; set; }

        /// <summary>
        /// The scale-in threshold for GPU instance. Default is `0.5`.
        /// </summary>
        [Input("gpuUtilizationThreshold")]
        public Input<string>? GpuUtilizationThreshold { get; set; }

        /// <summary>
        /// Maximum number of seconds CA waits for pod termination when trying to scale down a node. Default is `14400`.
        /// </summary>
        [Input("maxGracefulTerminationSec")]
        public Input<int>? MaxGracefulTerminationSec { get; set; }

        /// <summary>
        /// Minimum number of replicas that a replica set or replication controller should have to allow their pods deletion in scale down. Default is `0`.
        /// </summary>
        [Input("minReplicaCount")]
        public Input<int>? MinReplicaCount { get; set; }

        [Input("priorities")]
        private InputMap<string>? _priorities;

        /// <summary>
        /// Priority settings for autoscaling node pool scaling groups. This parameter only takes effect when `expander` is set to `priority`. Only supports scaler type `cluster-autoscaler`. Uses key-value pairs where the key is the priority value, and the value is a comma-separated list of scaling group IDs. High numerical values indicate higher priority.
        /// </summary>
        public InputMap<string> Priorities
        {
            get => _priorities ?? (_priorities = new InputMap<string>());
            set => _priorities = value;
        }

        /// <summary>
        /// Should CA delete the K8s node object when recycle node has scaled down successfully. Default is `false`.
        /// </summary>
        [Input("recycleNodeDeletionEnabled")]
        public Input<bool>? RecycleNodeDeletionEnabled { get; set; }

        /// <summary>
        /// Specify whether to allow the scale-in of nodes. Default is `true`.
        /// </summary>
        [Input("scaleDownEnabled")]
        public Input<bool>? ScaleDownEnabled { get; set; }

        /// <summary>
        /// Should CA scale up when there 0 ready nodes. Default is `true`.
        /// </summary>
        [Input("scaleUpFromZero")]
        public Input<bool>? ScaleUpFromZero { get; set; }

        /// <summary>
        /// The type of autoscaler. Valid values: `cluster-autoscaler`, `goatscaler`. For cluster version 1.22 and below, we only support `cluster-autoscaler`. When switching from `cluster-autoscaler` to `goatscaler`, all configuration parameters will be automatically migrated.
        /// </summary>
        [Input("scalerType")]
        public Input<string>? ScalerType { get; set; }

        /// <summary>
        /// The interval at which the cluster is reevaluated for scaling. Default is `30s`.
        /// </summary>
        [Input("scanInterval")]
        public Input<string>? ScanInterval { get; set; }

        /// <summary>
        /// If true cluster autoscaler will never delete nodes with pods with local storage, e.g. EmptyDir or HostPath. Default is `false`.
        /// </summary>
        [Input("skipNodesWithLocalStorage")]
        public Input<bool>? SkipNodesWithLocalStorage { get; set; }

        /// <summary>
        /// If true cluster autoscaler will never delete nodes with pods from kube-system (except for DaemonSet or mirror pods). Default is `true`.
        /// </summary>
        [Input("skipNodesWithSystemPods")]
        public Input<bool>? SkipNodesWithSystemPods { get; set; }

        /// <summary>
        /// Specify the time interval during which autoscaler does not perform scale-in operations after the most recent scale-out completion. Nodes added through scale-out can only be considered for scale-in after the period has elapsed. Default is `10m`.
        /// </summary>
        [Input("unneededDuration")]
        public Input<string>? UnneededDuration { get; set; }

        /// <summary>
        /// The scale-in a threshold. Default is `0.5`.
        /// </summary>
        [Input("utilizationThreshold")]
        public Input<string>? UtilizationThreshold { get; set; }

        public AutoscalingConfigArgs()
        {
        }
        public static new AutoscalingConfigArgs Empty => new AutoscalingConfigArgs();
    }

    public sealed class AutoscalingConfigState : global::Pulumi.ResourceArgs
    {
        /// <summary>
        /// The id of kubernetes cluster.
        /// </summary>
        [Input("clusterId")]
        public Input<string>? ClusterId { get; set; }

        /// <summary>
        /// Specify the time interval between detecting a scale-in requirement (when the threshold is reached) and actually executing the scale-in operation (reducing the number of Pods). Default is `10m`. If the delay (cooldown) value is set too long, there could be complaints that the Horizontal Pod Autoscaler is not responsive to workload changes. However, if the delay value is set too short, the scale of the replicas set may keep thrashing as usual.
        /// </summary>
        [Input("coolDownDuration")]
        public Input<string>? CoolDownDuration { get; set; }

        /// <summary>
        /// If true DaemonSet pods will be  terminated from nodes. Default is `false`.
        /// </summary>
        [Input("daemonsetEvictionForNodes")]
        public Input<bool>? DaemonsetEvictionForNodes { get; set; }

        /// <summary>
        /// The policy for selecting which node pool to scale. Valid values: `least-waste`, `random`, `priority`. For scaler type `goatscaler`, only the `least-waste` expander is currently supported. For more information on these policies, see [Configure auto scaling](https://www.alibabacloud.com/help/en/container-service-for-kubernetes/latest/auto-scaling-of-nodes#section-3bg-2ko-inl)
        /// </summary>
        [Input("expander")]
        public Input<string>? Expander { get; set; }

        /// <summary>
        /// The scale-in threshold for GPU instance. Default is `0.5`.
        /// </summary>
        [Input("gpuUtilizationThreshold")]
        public Input<string>? GpuUtilizationThreshold { get; set; }

        /// <summary>
        /// Maximum number of seconds CA waits for pod termination when trying to scale down a node. Default is `14400`.
        /// </summary>
        [Input("maxGracefulTerminationSec")]
        public Input<int>? MaxGracefulTerminationSec { get; set; }

        /// <summary>
        /// Minimum number of replicas that a replica set or replication controller should have to allow their pods deletion in scale down. Default is `0`.
        /// </summary>
        [Input("minReplicaCount")]
        public Input<int>? MinReplicaCount { get; set; }

        [Input("priorities")]
        private InputMap<string>? _priorities;

        /// <summary>
        /// Priority settings for autoscaling node pool scaling groups. This parameter only takes effect when `expander` is set to `priority`. Only supports scaler type `cluster-autoscaler`. Uses key-value pairs where the key is the priority value, and the value is a comma-separated list of scaling group IDs. High numerical values indicate higher priority.
        /// </summary>
        public InputMap<string> Priorities
        {
            get => _priorities ?? (_priorities = new InputMap<string>());
            set => _priorities = value;
        }

        /// <summary>
        /// Should CA delete the K8s node object when recycle node has scaled down successfully. Default is `false`.
        /// </summary>
        [Input("recycleNodeDeletionEnabled")]
        public Input<bool>? RecycleNodeDeletionEnabled { get; set; }

        /// <summary>
        /// Specify whether to allow the scale-in of nodes. Default is `true`.
        /// </summary>
        [Input("scaleDownEnabled")]
        public Input<bool>? ScaleDownEnabled { get; set; }

        /// <summary>
        /// Should CA scale up when there 0 ready nodes. Default is `true`.
        /// </summary>
        [Input("scaleUpFromZero")]
        public Input<bool>? ScaleUpFromZero { get; set; }

        /// <summary>
        /// The type of autoscaler. Valid values: `cluster-autoscaler`, `goatscaler`. For cluster version 1.22 and below, we only support `cluster-autoscaler`. When switching from `cluster-autoscaler` to `goatscaler`, all configuration parameters will be automatically migrated.
        /// </summary>
        [Input("scalerType")]
        public Input<string>? ScalerType { get; set; }

        /// <summary>
        /// The interval at which the cluster is reevaluated for scaling. Default is `30s`.
        /// </summary>
        [Input("scanInterval")]
        public Input<string>? ScanInterval { get; set; }

        /// <summary>
        /// If true cluster autoscaler will never delete nodes with pods with local storage, e.g. EmptyDir or HostPath. Default is `false`.
        /// </summary>
        [Input("skipNodesWithLocalStorage")]
        public Input<bool>? SkipNodesWithLocalStorage { get; set; }

        /// <summary>
        /// If true cluster autoscaler will never delete nodes with pods from kube-system (except for DaemonSet or mirror pods). Default is `true`.
        /// </summary>
        [Input("skipNodesWithSystemPods")]
        public Input<bool>? SkipNodesWithSystemPods { get; set; }

        /// <summary>
        /// Specify the time interval during which autoscaler does not perform scale-in operations after the most recent scale-out completion. Nodes added through scale-out can only be considered for scale-in after the period has elapsed. Default is `10m`.
        /// </summary>
        [Input("unneededDuration")]
        public Input<string>? UnneededDuration { get; set; }

        /// <summary>
        /// The scale-in a threshold. Default is `0.5`.
        /// </summary>
        [Input("utilizationThreshold")]
        public Input<string>? UtilizationThreshold { get; set; }

        public AutoscalingConfigState()
        {
        }
        public static new AutoscalingConfigState Empty => new AutoscalingConfigState();
    }
}
